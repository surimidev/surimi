---
import { getCollection } from 'astro:content';

import type { DocsCategory } from '../../../content.config';

import './Sidebar.css';

const docs = await getCollection('docs');

const SIDEBAR_LABELS = {
  gettingStarted: 'Getting Started',
  guides: 'Guides',
  apiReference: 'API Reference',
} satisfies Record<DocsCategory, string>;

const groupedDocs = Object.entries(SIDEBAR_LABELS).reduce(
  (acc, [category, label]) => {
    acc[label] = docs.filter(doc => doc.data.category === (category as DocsCategory));
    return acc;
  },
  {} as Record<string, typeof docs>,
);
---

<nav class="sidebar">
  <ul class="sidebar__list">
    {
      Object.entries(groupedDocs).map(([category, docs]) => (
        <li class="sidebar__category">
          <h3 class="sidebar__category-title">{category}</h3>
          <ul class="sidebar__category-list">
            {docs.map(doc => (
              <li class="sidebar__doc-item">
                <a href={`/docs/${doc.id}`} class="sidebar__doc-link">
                  {doc.data.title}
                </a>
              </li>
            ))}

            {docs.length === 0 ? (
              <li class="sidebar__doc-item sidebar__doc-item--empty">No documents available.</li>
            ) : null}
          </ul>
        </li>
      ))
    }
  </ul>
</nav>
