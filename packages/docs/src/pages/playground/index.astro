---
import { getCollection } from 'astro:content';
import { marked } from 'marked';

import Main from '#layouts/Main/Main.astro';

import { Playground } from '../../playground';

marked.setOptions({ gfm: true });

const rawLectures = await getCollection('lectures');
const sorted = rawLectures.sort((a, b) => a.data.orderId - b.data.orderId);

const lectures = sorted.map(entry => ({
  id: entry.id,
  title: entry.data.title,
  description: entry.data.description,
  files: entry.data.files,
  contentHtml: marked.parse(entry.body ?? '') as string,
}));

const lectureIdFromUrl = Astro.url.searchParams.get('lecture');
const initialLectureId =
  (lectureIdFromUrl && lectures.some(l => l.id === lectureIdFromUrl) ? lectureIdFromUrl : null) ??
  lectures[0]?.id ??
  '';
---

<Main title="Playground" hideDefaultHeader>
  <Playground client:only lectures={lectures} initialLectureId={initialLectureId} />
</Main>
